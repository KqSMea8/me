define("driver_register_second",function(e,t){function a(e,t){var a=document.createElement("IMG");a.onload=function(){t(a),a.onerror=a=a.onload=null},a.onerror=function(){t(null),a.onerror=a=a.onload=null},a.src=e}function r(e){return"string"!=typeof e&&(e=e.getAttribute("name")),1==pageParams.filed_list[e].changeable}function n(e){return"string"!=typeof e&&(e=e.getAttribute("name")),1==pageParams.filed_list[e].display}function o(e){return"string"!=typeof e&&(e=e.getAttribute("name")),3==pageParams.filed_list[e].verify}function i(){function t(e){function t(){document.body.onfocus=null,P[e].close()}var a={data:$.extend({},pageParams.upload_data),url:pageParams.api_upload_url,outputWidth:C[e][0],outputHeight:C[e][1],filekey:"file",onSuccessUpload:function(a){try{if(a=JSON.parse(a),"0"==a.errno)p.photo_upload_success(k[e]),A(k[e],a.data);else{if("101"!=a.errno)return void v.alert(a.errmsg);location.replace(pageParams.gologinurl)}}catch(r){return v.alert("服务器故障，上传失败，请重试！"),void O(k[e],r)}t()},onCancelUpload:function(){t()},onFileSelect:function(e,a){t(),a()},onFailedUpload:function(){t(),v.alert("上传超时，请重试！"),t()}},r=P[e].$container;r.show(),new n(r[0],a),r.hide()}function a(t){function a(){document.body.onfocus=null,P[t].close()}var r=P[t].$container;r.on("click",function(){var r=e("didibridge"),n=$.extend({},pageParams.upload_data,{web_token:pageParams.upload_data.token});delete n.token,r.uploadImage({data:n,url:pageParams.api_upload_url,outputWidth:C[t][0],outputHeight:C[t][1]},function(e){try{e=JSON.parse(e),p.photo_upload_success(k[t]),A(k[t],e.data.data)}catch(r){O(k[t],r)}a()},null)})}var n=e("imgcliper");$.each(y.find(".file_select"),function(e,n){function i(){document.body.onfocus=null,P[e].close()}var c=$(n);if(r(n)===!1)return void c.addClass("disabled");o(k[e])&&r(k[e])&&c.addClass("verify_failed"),"string"==typeof w[e]?(P[e].setOpt({img_src:w[e]}),P[e].setup()):w[e](function(t){var a=["e_avatar_1","e_avatar_2"];P[e].setOpt({img_src:t,custom_class:a[pageParams.gesturesample-1]}),P[e].setup()});var l=!1;c.on("click",function(){if(P[e].show(),document.body.onfocus=i,p.photo_upload_click(k[e]),l!==!0){l=!0,$(this).removeClass("verify_failed");var r=window.DidiJSBridge;r&&/android/i.test(navigator.userAgent)?a(e):t(e),P[e].show()}},!1)})}function c(){S&&p.show_step_uploadphotoes(),i(),k.forEach(function(e){var t=pageParams.filed_list[e].value||m.get(e);t&&A(e,t)}),y.find(".form_second .previous_btn").on("click",function(){s()}),y.find(".next_btn").on("click",function(){function e(e){var t=r.txtToJson(e);if("102"==t.errno)location.replace(pageParams.gologinurl);else if("0"==t.errno)p.click_inappstep03_finishbutton(),setTimeout(function(){m.clean(),u({travelauthpicurl:T.travelauthpicurl})},100);else{if("3002"!=t.errno)return n.alert(t.errmsg);m.clean(),u({travelauthpicurl:T.travelauthpicurl})}f.closeLoading()}var a=t.check_filed();if(a!==!1){f.showLoading(),$.ajax({type:"GET",url:pageParams.reg_url,data:$.extend({step:3,commit:1,regfrom:pageParams.regfrom,token:pageParams.upload_data.token},a),success:e,error:function(){n.alert("网络有点不给力，请稍后再试哦~")}});var r=dd.base,n=dd.dialog}})}function l(){for(var e=0;e<k.length;e++)if(r(y.find(b[e])[0])!==!1&&!T[k[e]])return y.trigger("is_full_fill",!1),!1;y.trigger("is_full_fill",!0)}var u,s,d=e("driver_register_second/layer/layer.js"),f=e("driver_register_tool"),p=e("log"),_="http://static.xiaojukeji.com/pinche/release/components/driver_register_second/driver_card_050b750.png",g="http://static.xiaojukeji.com/pinche/release/components/driver_register_second/car_license_e5ed36a.png",v=(pageParams.gesturesample,dd.dialog),m=f.localCache.instance("driver_register_second"),h=!1,y=t.$container=$(".form_second");t.wakeup=function(e,t,a){if(u=t,s=a,h===!1){h=!0;var r=!0;if($.each(k,function(e,t){return n(t)?(r=!1,!1):void 0}),r)return l(),void u();c()}};var k=["driveauthpicurl","travelauthpicurl","gestureauthpicurl"],b=[".driving_licence_front",".driving_licence_backend",".car_photo"],w=[_,g,"http://static.xiaojukeji.com/pinche/release/components/driver_register_second/layer/images/avatar_right2_d781194.jpg"],P=[new d({layerType:d.CARD}),new d({layerType:d.CARD}),new d({layerType:d.GESTURE,custom_class:""})],x=213/145,j=500,C=[[j,j/x],[j,j/x],[j,j]],T={},A=function(e,t){var r=k.indexOf(e);if(-1!==r){var n=$(b[r]);T[e]=t,n.addClass("photo_uploaded"),a(t,function(t){return null===t?(dd.dialog.alert({title:"",tip:"图片加载失败，请重新上传。",btn:{handler:function(){}}}),void O(e)):(t.className="pic",void n.find(".shadow").html(t))}),m.save_cache(e,t),l()}},O=function(e){var t=k.indexOf(e);-1!==t&&($pick_node=$(b[t]),$pick_node.removeClass("photo_uploaded"),delete T[e],m.remove_cache(e),l())};t.check_filed=function(){var e,t=!0,a={};if($.each(k,function(n,o){return r(o)!==!1?(a[o]=T[o],void 0==a[o]?(e=n,t=!1):void 0):void 0}),t===!1){var n=$(b[e]).find(".select_tips").text()||"完整资料";return v.alert({title:"",tip:"请"+n,btn:{handler:function(){}}}),!1}return a};var S=!1;t.log_when_show=function(e){S=e}});