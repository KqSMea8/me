define("ddplayer/player/ctrlProgress.js",function(e){"use strict";var r=e("ddplayer/player/mediaPlayer.js"),t=e("ddplayer/base/vars.js"),a=e("ddplayer/player/playHistory.js"),i=e("ddplayer/base/console.js"),o=(e("ddplayer/player/errorTypes.js"),function(e){var r=e.cache,t=r.srcList[r.modeType]||[];if(t.length>1){var a=e.videoTag.currentTime,i=r.curIndex;return $.each(t,function(e,r){return i>e?void(a+=r.duration||0):!1}),a}return e.videoTag.currentTime}),n=function(e){{var r=e.videoData;e.cache}if(0!==e.currentTime&&!e._makeHistoryFlag){var t={playTime:e.currentTime,duration:r.totalDuration,title:r.tvname||""};a.setHistory(t),e._makeHistoryFlag=!0,setTimeout(function(){e._makeHistoryFlag=!1},1e3)}},s=function(e){var r=e.videoData;if(e.cache.isRemHistory){var t={vid:r.vid,site:r.site},o=a.getHistory(t),n=null;o.length>0&&(n=o[0],i.log("prgress:",n.playTime),e.seekTo(n.playTime)),e._playByHistoryFlag=!0}},d=function(e){e._addEvent("timeupdate",function(){e._sendVVFlag||(e._sendVVFlag=!0),!ddvp.debug.isShowPlayerPlayStartTime&&e.currentTime>0&&(i.log("视频加载时间:"+(Date.now()-ddvp.debug.playerPlayStartTime)/1e3+"秒"),ddvp.debug.isShowPlayerPlayStartTime=!0);var r=e.cache;""===e.videoData.totalDuration&&e.videoTag.duration&&(r.duration=e.videoData.duration=e.videoData.totalDuration=e.videoTag.duration);var a=e.duration=r.duration,d=e.currentTime=o(e);if(d>0&&((!t.IsIphone||t.IsIphone&&t.IsWeiXinBrowser)&&e.hidePoster(),e._hideLoading(),d>1)){e._sendRealVVFlag||(e._sendRealVVFlag=!0),r.isRemHistory&&(e._playByHistoryFlag||s(e),n(e)),d>0&&Math.abs(d-e._lastCurTime)>2&&(e._startPlayTime=$.now()),(t.IsIphone||t.IsOldWindowsPhone)&&e.$midModeList.oriHide(),e._lastCurTime=d,!e._sendEndFlag&&d>a-15&&(e._sendEndFlag=!0),null===e._traceHeartInterval&&(e._traceHeartInterval=setInterval(function(){},12e4)),e._changeModeFlag=!1,e._dragRangeFlag=!1,e._firstWaitingFlag=!1,t.IsIphone&&!t.IsWeiXinBrowser||t.IsOldWindowsPhone||/Android\/?\s?2\../i.test(t.UA)||t.IsQQBrowser||t.IsUCBrowser?e._showPlayBtn():t.IsIphone||t.IsIpad||e._showPauseBtn();var l=d/a*100+"%";if(d>=a&&r.timeLimit===a){d=a,l="100%";var u=r.timeLimit,c=(u-u%60)/60;c=u%60===0?c:c+1}d>a&&(d=a),e.$ctrlCurTime.html($.formatSeconds(d)),e.$ctrlDuration.html($.formatSeconds(a)),e._dragFlag||e.$ctrlCurPlayedBar.css({width:l}),t.IsUCBrowser&&t.IsIphone&&parseInt(d,10)===parseInt(a,10)&&e._fireEvent("ended")}})},l=function(e){e.$ctrlDragAnchor.on(t.START_EVENT,function(r){return clearTimeout(e._hideMainCtrlTime),clearTimeout(e._rewindForwardInterval),e.$midRewindForwardCon.oriShow(),e._dragFlag=!0,e._dragRangeFlag=!0,e._touchStratX=r.touches&&r.touches[0]?r.touches[0].pageX:r.pageX,!1}),e.$ctrlDragAnchor.on(t.MOVE_EVENT,function(r){if(e._dragFlag){var t=e.$ctrlTrackBar.width(),a=e.duration,i=e.currentTime;clearTimeout(e._hideMainCtrlTime),clearTimeout(e._rewindForwardInterval);var o=function(r,t){e.$mid.oriShow(),i>r?e.$midRewindForwardCon.addClass("rewind").removeClass("forward"):e.$midRewindForwardCon.addClass("forward").removeClass("rewind"),e._moveTime=r,e.$midTime.html($.formatSeconds(r)),e.$ctrlCurPlayedBar.width(r/t*100+"%")};e._touchMoveX=r.touches&&r.touches[0]?r.touches[0].pageX:r.pageX;var n=a/t*(e._touchStratX-e._touchMoveX)*-1,s=i+n;0>s?o(0,a):s>a?o(a,a):o(s,a)}return!1}),e.$ctrlDragAnchor.on(t.END_EVENT+" mouseout",function(){return e._dragFlag&&(e._dragFlag=!1,e.seekTo(e._moveTime),e._startPlayTime=$.now(),e._rewindForwardInterval=setTimeout(function(){e.$midRewindForwardCon.oriHide()},2e3),e._hideMainCtrlTime=setTimeout(function(){e._hideMainCtrl()},3e3)),!1})},u=function(e){e.$ctrlBar.on(t.END_EVENT,function(){return!1}),e.$ctrlTrackBar.on(t.START_EVENT,function(r){var t=$(this),a=r.touches&&r.touches[0]?r.touches[0].pageX:r.pageX,i=a-t.offset().left,o=t.width(),n=e.duration/o*i;return e._startPlayTime=$.now(),e.seekTo(n),!1})};r.prototype._initCtrlProgress=function(){this._sendRealVVFlag=!1,this._sendEndFlag=!1,this._playByHistoryFlag=!1,this._makeHistoryFlag=!1,this._lastCurTime=0,this._startPlayTime=0,this._bufferCount=0,this._traceHeartInterval=null,this._rewindForwardInterval=null,this._dragRangeFlag=!1,this._changeModeFlag=!1,this._firstWaitingFlag=!0,this._dragFlag=!1,this._touchStratX=0,this._touchMoveX=0,this._moveTime=-1,d(this),"live"!==this.config.mediaType&&(l(this),u(this))}});