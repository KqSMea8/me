define("didi-component-imgcliper/imgcliper.js",function(t,e,i){function n(){function t(t){t=(t||navigator.userAgent).toLowerCase();var e=t.match(/android\s([0-9\.]*)/);return e?e[1]:!1}var e=t();e=e&&e.slice(0,3);var i=navigator.userAgent.match(/(iPhone\sOS)\s([\d_]+)/)||navigator.userAgent.match(/(iPad).*OS\s([\d_]+)/),n=i&&i[2].split("_")[0],o=n>=7||e>4,r=navigator.userAgent;(0===r.indexOf("MQQBrowser/3.4")||r.indexOf("Android 2.3.6")>-1)&&(o=!1);var a=document.createElement("DIV");return a.style["-webkit-transform"]="",a.style["-webkit-transform"]="rotateY(90deg)",""!==a.style["-webkit-transform"]&&o}var o=t("didi-component-imgcliper/clippinchzoom.js"),r=i.exports=function(t){var e=t.rawData,i=t.onSave;this.rawData=e,this.onSave=i,this.onCancel=t.onCancel||function(){},this.opt=$.extend({},a,t);var r=this.setup(e),h=!n();this.pinchZoom=new o(r,{imgWidth:t.originWidth,imgHeight:t.originHeight,imgCliper:this,use2d:h})},a={barHeight:70,cancel:"取消",confirm:"确定",btnOrder:1,clipWidth:500,clipHeight:500},h=function(t,e){var i=document.createElement(e||"DIV");return i.style.cssText=t.join(";"),i};r.prototype={getViewportRect:function(){var t,e=this,i=innerWidth/innerHeight,n=e.opt.clipWidth/e.opt.clipHeight;t=1>i?n>i?innerWidth:innerHeight*n:i>n?innerHeight*n:innerWidth;var o=t/n;return{w:t,h:o,x:(innerWidth-t)/2,y:(innerHeight-o)/2}},setup:function(t){function e(){clearTimeout(f),f=setTimeout(g,200)}var i=this,n=h(["position: absolute","background-color: rgba(0,0,0,1)","left:0","top:0","z-index: 9998","overflow: hidden"]);n.id="container"+~~(1e6*Math.random());var o=h(["position: absolute","z-index: 1","background-color: rgba(0,0,0,.5)","pointer-events: none"]);o.id="maskTop"+~~(1e6*Math.random());var r=h(["position: absolute","z-index: 1","background-color: rgba(0,0,0,.5)","pointer-events: none"]);r.id="maskbottom"+~~(1e6*Math.random());var a=h(["position: absolute","z-index: 1","box-sizing: border-box","-webkit-box-sizing: border-box","width: "+Math.min(innerWidth,innerHeight)+"px","height: "+Math.min(innerWidth,innerHeight)+"px","border: 1px solid #fff","background-color: transparent","pointer-events: none"]);a.id="viewport"+~~(1e6*Math.random());var d=h(["-webkit-user-drag: none","z-index: 0","-webkit-tap-highlight-color: rgba(0,0,0,0)","position: absolute"],"IMG");d.id="photo"+~~(1e6*Math.random());var p=h(["-webkit-user-drag: none","position: absolute","text-align: center","z-index: 0;"]);p.id="photoFrame"+~~(1e6*Math.random()),d.src=t;var s=h(["text-align: center","color: white","display: inline-block","font-weight: bold","line-height : "+i.opt.barHeight+"px","font-size: 1.8rem"]),l=h(["text-align: center","color: white","display: inline-block","font-weight: bold","font-size: 1.8rem","line-height :"+i.opt.barHeight+"px"]),c=h(["background-color: rgba(0,0,0,0.6)","position: absolute","right: 0","bottom: 0","z-index: 1"]),g=function(){var t=innerWidth/innerHeight,e=i.getViewportRect(),h=e.w,g=e.h;n.style.top=pageYOffset+"px",n.style.left=pageXOffset+"px",p.style.width=n.style.width=innerWidth+"px",p.style.lineHeight=p.style.height=n.style.height=innerHeight+"px",a.style.left=e.x+"px",a.style.top=e.y+"px",a.style.height=g+"px",a.style.width=h+"px",o.style.height=r.style.height=(h===innerWidth?(innerHeight-g)/2:g)+"px",o.style.width=r.style.width=(h===innerWidth?h:(innerWidth-h)/2)+"px",o.style.left=0,o.style.top=0,r.style.bottom=0,r.style.right=0,d.style[1>t?"width":"height"]="100%",d.style[1>t?"height":"width"]="auto",d.style.left=1>t?"0":(innerWidth-i.opt.originWidth/i.opt.originHeight*innerHeight)/2+"px",d.style.top=1>t?(innerHeight-i.opt.originHeight/i.opt.originWidth*innerWidth)/2+"px":"0",c.style[1>t?"height":"width"]=i.opt.barHeight+"px",c.style[1>t?"width":"height"]=(1>t?innerWidth:innerHeight)+"px",s.style[1>t?"height":"width"]=l.style[1>t?"height":"width"]=i.opt.barHeight+"px",s.style[1>t?"width":"height"]=l.style[1>t?"width":"height"]=(1>t?innerWidth:innerHeight)/2+"px"},m=function(t){var e=t.target.tagName?t.target:t.target.parentNode;0===e.id.indexOf("confirm")?i.clipSource():0===e.id.indexOf("cancel")&&(i.onCancel(),i.close())},u=function(t){t.preventDefault(),t.stopPropagation()};g();var f;return p.appendChild(d),l.innerHTML=1==i.opt.btnOrder?i.opt.cancel:i.opt.confirm,s.innerHTML=1==i.opt.btnOrder?i.opt.confirm:i.opt.cancel,l.id=(1===i.opt.btnOrder?"cancel":"confirm")+~~(1e6*Math.random()),s.id=(1===i.opt.btnOrder?"confirm":"cancel")+~~(1e6*Math.random()),c.appendChild(l),c.appendChild(s),n.appendChild(o),n.appendChild(r),n.appendChild(a),n.appendChild(p),n.appendChild(c),document.body.appendChild(n),c.addEventListener("click",m,!1),window.addEventListener("resize",e,!1),window.addEventListener("scroll",e,!1),n.addEventListener("touchmove",u,!1),i.$photo=d,i.$viewport=a,i.$container=n,i.removeOut=function(){n.parentNode.removeChild(n),c.removeEventListener("click",m,!1),window.removeEventListener("resize",e,!1),window.removeEventListener("scroll",e,!1)},p},clipSource:function(){var t=this,e=t.pinchZoom.zoomFactor,i=$(t.$photo).offset(),n=$(t.$viewport).offset(),o={x:n.left-i.left,y:n.top-i.top},r={w:t.opt.clipWidth,h:t.opt.clipHeight},a=t.opt.clipWidth/t.getViewportRect().w;o.x*=a,o.y*=a;var h=document.createElement("CANVAS"),d=h.getContext("2d");if(h.width=r.w,h.height=r.h,d.drawImage(t.$photo,-o.x,-o.y,t.$photo.width*e*a,t.$photo.height*e*a),"image/png"===t.opt.fileType)var p=h.toDataURL("image/png");else var p=h.toDataURL("image/jpeg");t.onSave(p)},openImage:function(t){var e=window.open("about:blank","runWindow");e.opener=null,e.document.open(),e.document.write('<img src="'+t+'" />'),e.document.close()},show:function(t){if(t){var e=t.rawData;e&&(this.rawData=e,this.$photo.src=t.rawData),t.onSave&&(this.onSave=t.onSave),this.opt=$.extend({},a,t),this.pinchZoom.offset={x:0,y:0},this.pinchZoom.zoomFactor=1}this.$container.style.display="block"},close:function(){this.$container.style.display="none",this.destroy()},destroy:function(){this.removeOut();for(var t in this)this.hasOwnProperty(t)&&delete this[t];this.destroy=function(){}}}});