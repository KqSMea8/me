!function(t){function e(t,e){this.file=t,this.options=r.extend({},n,e),this._defaults=n,this._name=a,this.init()}var a="canvasResize",r={newsize:function(t,e,a,r,n){var i=n?"h":"";if(a&&t>a||r&&e>r){var o=t/e;(o>=1||0===r)&&a&&!n?(t=a,e=a/o>>0):n&&a/r>=o?(t=a,e=a/o>>0,i="w"):(t=r*o>>0,e=r)}return{width:t,height:e,cropped:i}},dataURLtoBlob:function(t){for(var e=t.split(",")[0].split(":")[1].split(";")[0],a=atob(t.split(",")[1]),r=new ArrayBuffer(a.length),n=new Uint8Array(r),i=0;i<a.length;i++)n[i]=a.charCodeAt(i);var o=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder;return o?(o=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder),o.append(r),o.getBlob(e)):o=new Blob([r],{type:e})},detectSubsampling:function(t){var e=t.width,a=t.height;if(e*a>1048576){var r=document.createElement("canvas");r.width=r.height=1;var n=r.getContext("2d");return n.drawImage(t,-e+1,0),0===n.getImageData(0,0,1,1).data[3]}return!1},rotate:function(t,e){var a={1:{90:6,180:3,270:8},2:{90:7,180:4,270:5},3:{90:8,180:1,270:6},4:{90:5,180:2,270:7},5:{90:2,180:7,270:4},6:{90:3,180:8,270:1},7:{90:4,180:5,270:2},8:{90:1,180:6,270:3}};return a[t][e]?a[t][e]:t},transformCoordinate:function(t,e,a,r){switch(r){case 5:case 6:case 7:case 8:t.width=a,t.height=e;break;default:t.width=e,t.height=a}var n=t.getContext("2d");switch(r){case 1:break;case 2:n.translate(e,0),n.scale(-1,1);break;case 3:n.translate(e,a),n.rotate(Math.PI);break;case 4:n.translate(0,a),n.scale(1,-1);break;case 5:n.rotate(.5*Math.PI),n.scale(1,-1);break;case 6:n.rotate(.5*Math.PI),n.translate(0,-a);break;case 7:n.rotate(.5*Math.PI),n.translate(e,-a),n.scale(-1,1);break;case 8:n.rotate(-.5*Math.PI),n.translate(-e,0)}},detectVerticalSquash:function(t,e,a){var r=document.createElement("canvas");r.width=1,r.height=a;var n=r.getContext("2d");n.drawImage(t,0,0);for(var i=n.getImageData(0,0,1,a).data,o=0,c=a,s=a;s>o;){var h=i[4*(s-1)+3];0===h?c=s:o=s,s=c+o>>1}var l=s/a;return 0===l?1:l},callback:function(t){return t},extend:function(){var t=arguments[0]||{},e=1,a=arguments.length,n=!1;t.constructor===Boolean&&(n=t,t=arguments[1]||{}),1===a&&(t=this,e=0);for(var i;a>e;e++)if(null!==(i=arguments[e]))for(var o in i)t!==i[o]&&(n&&"object"==typeof i[o]&&t[o]?r.extend(t[o],i[o]):void 0!==i[o]&&(t[o]=i[o]));return t}},n={width:300,height:0,crop:!1,quality:80,rotate:0,callback:r.callback};e.prototype={init:function(){function t(t){var n=atob(t.split(",")[1]),i=new BinaryFile(n,0,n.length),o=EXIF.readFromBinaryFile(i),c=new Image;c.onload=function(){var t=o.Orientation||1;t=r.rotate(t,e.options.rotate);var n=t>=5&&8>=t?r.newsize(c.height,c.width,e.options.width,e.options.height,e.options.crop):r.newsize(c.width,c.height,e.options.width,e.options.height,e.options.crop),i=c.width,s=c.height,h=n.width,l=n.height,d=document.createElement("canvas"),w=d.getContext("2d");w.save(),r.transformCoordinate(d,h,l,t),r.detectSubsampling(c)&&(i/=2,s/=2);var u=1024,g=document.createElement("canvas");g.width=g.height=u;for(var p=g.getContext("2d"),v=r.detectVerticalSquash(c,i,s),f=0;s>f;){for(var m=f+u>s?s-f:u,b=0;i>b;){var B=b+u>i?i-b:u;p.clearRect(0,0,u,u),p.drawImage(c,-b,-f);var y=Math.floor(b*h/i),I=Math.ceil(B*h/i),k=Math.floor(f*l/s/v),x=Math.ceil(m*l/s/v);w.drawImage(g,0,0,B,m,y,k,I,x),b+=u}f+=u}w.restore(),g=p=null;var M=document.createElement("canvas");M.width="h"===n.cropped?l:h,M.height="w"===n.cropped?h:l;var C="h"===n.cropped?.5*(l-h):0,R="w"===n.cropped?.5*(h-l):0;newctx=M.getContext("2d"),newctx.drawImage(d,C,R,h,l);a.type||e.options.fileType;if("image/png"===a.type)var z=M.toDataURL(a.type);else var z=M.toDataURL("image/jpeg",.01*e.options.quality);e.options.callback(z,M.width,M.height)},c.src=t}var e=this,a=this.file;if(a instanceof File){var n=new FileReader;n.onloadend=function(e){var a=e.target.result;t(a)},n.readAsDataURL(a)}else t(a.dataURL)}},t[a]=function(t,a){return"string"==typeof t?r[t](a):void new e(t,a)}}(window);