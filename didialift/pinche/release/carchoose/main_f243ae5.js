define("carchoose/main.js",function(){!function(n){function t(){g(),y(),T()}function i(){w()}function a(){window.dd&&window.dd.dialog&&window.dd.dialog.loading("正在加载",2e3)}function e(){window.dd&&window.dd.dialog&&window.dd.dialog.loading("正在加载",100)}function o(){S&&S.height(n(window).height())}function r(){S=n('<div class="choose-cartype-layer" />').prependTo("body").css("visibility","hidden"),o(),S.append('<section class="choose-brand-layer"><div></div></section>'),S.append('<section class="choose-type-layer"><div></div></section>'),S.append('<section class="choose-color-layer"><div></div></section>'),z=n(".choose-brand-layer").append('<div class="choose-cartype-shortcut"></div>'),F=n(".choose-type-layer"),I=n(".choose-color-layer"),$shortcut=z.find(".choose-cartype-shortcut"),s()}function s(){a(),n.ajax({url:M,dataType:"json",success:function(n){e(),"0"==n.errno&&(d(n.data),S.css("visibility","visible"),w(),c(n.data),u(),f(),h(),l())},error:function(){e()}})}function c(n){var t=[];for(var i in n)t.push(['<div><a href="javascript:void(0);" data-anchor="car-brand-',i,'">',i,"</a></div>"].join(""));$shortcut.html(t.join(""))}function d(n){var t=[];for(var i in n){t.push(['<h3 id="car-brand-'+i+'">',"<div><span>"+i+"</span></div>","</h3>","<ul>"].join(""));for(var a=n[i],e=0;e<a.length;e++)t.push(['<li data-brand-id="'+a[e].brand_id+'">',a[e].name,"</li>"].join(""));t.push("</ul>")}z.find("div").html(t.join("")),k?k.refresh():k=new IScroll(z[0],{click:!0,deceleration:L})}function l(){$shortcut.on("click",function(t){var i,a=n(t.target).closest("a");a.length&&(a.addClass("selected"),setTimeout(function(){a.removeClass("selected")},200),i=a.data("anchor"),k.scrollToElement("#"+i,0))})}function u(){z.on("click",function(t){var i,o,r=n(t.target).closest("li");r.length&&r!=O&&(O&&O.removeClass("selected"),O=r,r.addClass("selected"),i=r.data("brand-id"),o=r.text(),_.brand={id:i,name:o},X[i]?(p(X[i]),m(),T()):(y(),T(),a(),n.ajax({url:N+"?carbrand="+i,dataType:"json",success:function(n){e(),0==n.errno&&(X[i]=n.data,p(n.data),m())},error:function(){e()}})))})}function f(){F.on("click",function(t){var i,o,r,s=n(t.target).closest("li");s.length&&s!=Z&&(Z&&Z.removeClass("selected"),Z=s,s.addClass("selected"),i=s.data("brand-type-id"),o=s.text(),r=new RegExp(_.brand.name.replace(/[\\\|*+?^$]/g,"\\$&"),"g"),_.type={id:i,shortName:o.replace(r,""),name:o},$?b():(T(),a(),n.ajax({url:R,dataType:"json",success:function(n){e(),0==n.errno&&($=n.data,v(n.data),b())},error:function(){e()}})))})}function h(){I.on("click",function(i){var a,e,o,r=n(i.target).closest("li");r.length&&(a=r.data("color-id"),e=r.text(),_.color={id:a,name:e},o=A.subStrg(_.brand.name,6)+" "+A.subStrg(_.type.shortName,4)+" "+_.color.name,U&&U({value:_,carInfo:o}),t())})}function p(n){for(var t=["<ul>"],i=n,a=0;a<i.length;a++)t.push(['<li data-brand-type-id="'+i[a].brand_type_id+'">',i[a].brand_type_name,"</li>"].join(""));t.push("</ul>"),F.find("div").html(t.join("")),C?C.refresh():C=new IScroll(F[0],{click:!0,deceleration:L})}function v(n){var t=["<ul>"],i=n;for(var a in i)t.push(['<li data-color-id="'+a+'">',i[a].name,"</li>"].join(""));t.push("</ul>"),I.find("div").html(t.join("")),D?D.refresh():D=new IScroll(I[0],{click:!0,deceleration:L})}function w(){x(S[0],n(window).width(),0),x(S[0],0,150)}function g(){O&&O.removeClass("selected"),O=null,x(S[0],0,0),x(S[0],n(window).width(),150)}function m(){x(F[0],-.66*n(window).width(),150)}function y(){Z&&Z.removeClass("selected"),Z=null,x(F[0],-.66*n(window).width(),0),x(F[0],0,150)}function b(){x(I[0],-.33*n(window).width(),150)}function T(){x(I[0],-.33*n(window).width(),0),x(I[0],0,150)}function x(n,t,i,a,e){var o=n&&n.style,r="",s="";if(a||(a="linear"),e||(e=0),o){if("[object Array]"===Object.prototype.toString.call(t))switch(t.length){case 3:r=s="translate3d("+t[0]+"px,"+t[1]+"px,"+t[2]+"px)";break;case 2:r=s="translate("+t[0]+"px,"+t[1]+"px)translateZ(0)";break;case 1:r="translate("+t[0]+"px,0)translateZ(0)",s="translateX("+t[0]+"px)";break;default:r="translate("+t[0]+"px,0)translateZ(0)",s="translateX("+t[0]+"px)"}else{if(isNaN(parseInt(t)))return;r="translate("+t+"px,0)translateZ(0)",s="translateX("+t+"px)"}o.webkitTransitionDuration=o.MozTransitionDuration=o.msTransitionDuration=o.OTransitionDuration=o.transitionDuration=i+"ms",o.webkitTransitionTimingFunction=o.MozTransitionTimingFunction=o.msTransitionTimingFunction=o.OTransitionTimingFunction=o.transitionTimingFunction=a,o.webkitTransitionDelay=o.MozTransitionDelay=o.msTransitionDelay=o.OTransitionDelay=o.transitionDelay=e+"ms",o.webkitTransform=r,o.msTransform=o.MozTransform=o.OTransform=s}}function j(n){return S?void i():(n=n||{},M=n.brandsURL||"/pinche/cartype/getcarbrand",N=n.typesURL||"/pinche/cartype/getcartype",R=n.colorsURL||"/pinche/cartype/getcolor",U=n.onselect||function(){},void r())}var k,C,D,S,z,F,I,O,Z,$,_,L,M,N,R,U,X={};L=.002,_={brand:{},type:{},color:{}},n(window).on("resize",function(){o()});var A=function(){var n=function(n){return n.replace(/[^\x00-\xff]/g,"**").length},t=function(t,i){if(null==t)return"";if(n(t)>i){for(var a,e=0,o="",r=0;r<t.length;r++)if(a=t.charAt(r),e+=n(a),e>=i){o=t.substring(0,r+1);break}return o+="..."}return t};return{LenB:n,subStrg:t}}();n.didiCarChoose=function(n){j(n)}}(Zepto)});