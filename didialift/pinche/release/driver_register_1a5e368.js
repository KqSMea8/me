var base=dd.base,rm_wall=function(){for(var e=document.getElementsByClassName("select-wall"),t=0,n=e.length;n>t;t++)document.body.removeChild(e[t])},add_wall=function(){var e=document.createElement("div");e.id="d-wall",e.className="select-wall",e.style.width=document.clientWidth+"px",e.style.height=document.body.scrollHeight+"px",document.body.appendChild(e)},slideSelect_carno=function(e,t,n){function a(e){var t=0,n=0;e.addEventListener("touchstart",function(e){if(e.preventDefault(),!e.touches.length)return!1;var n=e.touches[0];t=n.pageY-this.offsetTop},!1),e.addEventListener("touchmove",function(e){if(e.preventDefault(),!e.touches.length)return!1;var a=e.touches[0],r=a.pageY-this.offsetTop;n=t-r,t=r,this.scrollTop+=n},!1),e.addEventListener("touchend",function(e){if(e.preventDefault(),!e.changedTouches.length)return!1;t=0,n=0;var a=this.scrollTop,r=a%44;22>r?this.scrollTop-=r:this.scrollTop+=44-r},!1)}var r=n||[],i=[],c=t.getElementsByClassName("cancel")[0],l=t.getElementsByClassName("confirm")[0],o=t.getElementsByClassName("options");base.touch(e,function(){for(var e=document.getElementsByClassName("select"),a=0,r=e.length;r>a;a++)e[a].style.display="none";t.style.display="block",add_wall();for(var i=null,c="",l=null,s=0,u=o.length;u>s;s++){i=o[s],c=n[s],l=i.getElementsByTagName("li");for(var d=0,m=l.length;m>d;d++)l[d].getAttribute("data-id")==c&&(i.scrollTop=44*d)}},!1),c.addEventListener("click",function(){t.style.display="none",rm_wall()},!1);var s=function(e){var t=document.createEvent("Events");return t.initEvent(e,!0,!0),t};l.addEventListener("click",function(){for(var n=null,a=null,c=0,l=o.length;l>c;c++){n=o[c];var u=n.scrollTop/44,a=n.getElementsByTagName("li")[u];r[c]=a.getAttribute("data-id"),i[c]=a.getAttribute("data-show")}var d=e.value;e.value=i.join(""),e.setAttribute("data-id",r.join("")),d!=e.value&&e.dispatchEvent&&e.dispatchEvent(s("change")),t.style.display="none",rm_wall()},!1);for(var u=0,d=o.length;d>u;u++)a(o[u],u)};dd.ready(function(){function e(){var e=document.getElementById("carnoSelect");ulEl=e.getElementsByClassName("options")[0];var t=function(){o.ajax({method:"POST",url:"/pinche/cartype/getlicensehead",succFunc:function(t){var n=o.txtToJson(t);if("0"==n.errno){for(var a=n.data,r=n.sort,i="",c=0,l=r.length;l>c;c++)i+='<li data-id="'+r[c]+'" data-show="'+a[r[c]]+'">'+a[r[c]]+"</li>";ulEl.innerHTML+=i,slideSelect_carno(txt_carOne,e,[])}},failFunc:function(){}})};t()}function t(){var e=function(e,t){u[e]=t,localStorage.driver_form=JSON.stringify(u)};txt_realname.addEventListener("change",function(){e("txt_realname",this.value)},!1),txt_licence.addEventListener("change",function(){e("txt_licence",this.value)},!1),txt_carower.addEventListener("change",function(){e("txt_carower",this.value)},!1),txt_carOne.addEventListener("change",function(){e("txt_carOne",txt_carOne.value),e("txt_carOne_id",txt_carOne.getAttribute("data-id"))},!1),txt_carOne2.addEventListener("change",function(){e("txt_carOne2",this.value)},!1),u&&(txt_realname.value=u.txt_realname||"",txt_licence.value=u.txt_licence||"",txt_carower.value=u.txt_carower||"",txt_carOne.value=u.txt_carOne||"",txt_carOne.setAttribute("data-id",u.txt_carOne_id||""),txt_carOne2.value=u.txt_carOne2||"")}function n(){txt_realname.addEventListener("focus",function(){this.className=""},!1),txt_realname.addEventListener("blur",function(){d.is_Chinese_name(this.value)||(this.className="error")},!1),txt_licence.addEventListener("focus",function(){this.className=""},!1),txt_licence.addEventListener("blur",function(){d.is_ID_card(this.value)||(this.className="error")},!1),txt_carower.addEventListener("focus",function(){this.className=""},!1),txt_carower.addEventListener("blur",function(){d.is_Chinese_name(this.value)||(this.className="error")},!1),txt_carOne2.addEventListener("focus",function(){this.className=""},!1),txt_carOne2.addEventListener("blur",function(){d.is_carNo(this.value)||(this.className="error")},!1)}function a(e){var t=function(e,t){s.alert({title:"",tip:t,btn:{handler:function(){e.focus()}}})};if("1"===pageParams.drive_license_changeable){if(!d.is_Chinese_name(e.drive_license_name))return t(txt_realname,"请填写真实姓名"),!1;if(!d.is_ID_card(e.drive_license_number))return t(txt_licence,"身份证号填写错误"),!1}if("1"===pageParams.travel_license_changeable){if(!d.is_Chinese_name(e.travel_license_name))return t(txt_carower,"行驶证姓名填写错误"),!1;if(""==txt_carOne.value)return s.alert("请选择车牌归属地"),!1;if(!d.is_carNo(e.car_license_number))return t(txt_carOne2,"车牌号填写错误"),!1}return!0}function r(e){s.loading("正在请求，请稍后~"),o.ajax({method:"POST",url:pageParams.submit_url,data:e,succFunc:function(e){var t=o.txtToJson(e);"0"==t.errno?(localStorage.removeItem("driver_form"),location.replace(t.url)):"3002"==t.errno?(localStorage.removeItem("driver_form"),location.replace(t.url)):c(function(){s.alert(t.errmsg)})},failFunc:function(){s.alert("网络有点不给力，请稍后再试哦~")}})}function i(e){$(".main").attr("class","main animate begin_animate"),setTimeout(function(){$(".main").attr("class","main animate end_animate")},0),setTimeout(function(){$(".main").attr("class","main ended_animate"),e()},350)}function c(e){$(".main").attr("class","main animate end_animate"),setTimeout(function(){$(".main").attr("class","main animate begin_animate")},0),setTimeout(function(){$(".main").attr("class","main"),e()},450)}function l(e){if(l.data_form=e,m!==!0){m=!0;var t=["driveauthpicurl","travelauthpicurl"],n=[".driving_licence_front",".driving_licence_backend"],a={},i=function(e,r){var i=t.indexOf(e);if(-1!==i){var c=$(n[i]);a[e]=r,c.addClass("photo_uploaded"),c.find(".shadow").css("background-image","url("+r+")"),_.set(e,r)}},c=function(e,r){var i=t.indexOf(e);-1!==i&&($pick_node=$(n[i]),$pick_node.find(".shadow").html("error | "+r.message),$pick_node.removeClass("photo_uploaded"),delete a[e])};addEventListener("error",function(e){$(".driving_licence_backend").find(".shadow").html(e.message)},!1),t.forEach(function(e){var t=_.get(e);t&&i(e,t)}),$(".upload_card").on("click",".file_select",function(e){var a=$(e.currentTarget),r=a.attr("class").trim();if(r=r.split(/\s+/)[1],0!=r){var l=n.indexOf("."+r);if(-1!==l){var o=require("ddbridge/ddbridge.js");o.uploadImage({web_token:pageParams.upload_token},function(e){try{e=JSON.parse(e),i(t[l],e.data.data)}catch(n){c(t[l],n)}},null,pageParams.api_upload_url)}}}),o.touch($(".register_submit")[0],function(){var i,c=!0;if($.each(t,function(e,t){return void 0===a[t]?(i=e,c=!1):void 0}),c===!1){var o=$(n[i]).find(".select_tips").text()||"完整资料";return void s.alert({title:"",tip:"请填写"+o,btn:{handler:function(){}}})}e=$.extend(l.data_form,a),r(e)})}}var o=dd.base,s=dd.dialog,u=o.txtToJson(localStorage.driver_form||{}),d={is_Chinese_name:function(e){var t=/^[\u4E00-\u9FA5]{2,}$/;return t.test(e)?!0:!1},is_ID_card:function(e){var t=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;return t.test(e)===!1?!1:!0},is_carNo:function(e){var t=/^[A-Za-z]{1}[A-Za-z0-9]{5}$/;return t.test(e)?!0:!1}};!function(){e(page_driver.car_province_id),"join"==pageParams.type&&t(),n(),$(btnSubmit).on("click",function(){if("btn-gray"!=btnSubmit.className){for(var e=document.getElementsByTagName("input"),t=0,n=e.length;n>t;t++){var r=e[t];r.setAttribute("readOnly","true"),r.blur()}scrollTo(0,0),setTimeout(function(){for(t=0,n=e.length;n>t;t++){var a=e[t];a.removeAttribute("readOnly")}},100);var c={drive_license_name:txt_realname.value,drive_license_number:txt_licence.value.toLocaleUpperCase(),travel_license_name:txt_carower.value,car_province_id:txt_carOne.getAttribute("data-id"),car_license_number:txt_carOne2.value.toLocaleUpperCase(),phone_number:pageParams.phone||"",token:pageParams.token||"",sign:pageParams.sign||""},o=a(c);o&&i(function(){l(c)})}})}();var m=!1,_={set:function(e,t){try{return localStorage.setItem(e,t),!0}catch(n){return!1}},get:function(e){try{return localStorage.getItem(e)}catch(t){return!1}},remove:function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}}});
;define("ddbridge/ddbridge.js",function(i,a,e){e.exports=window.Didibridge=function(){};var r=["callbackImageLiteratureReviewTakeCamera","callbackImageLiteratureReviewPhotoLibrary","callbackImageLiteratureReview"];Didibridge.uploadImage=function(i,e,t,d){if("function"!=typeof e)throw"must supply callback function";if(void 0===d)throw"must supply upload url";var l;switch(t){case"camera":l=r[0];break;case"library":l=r[1];break;default:l=r[2]}var c={data:i,url:d};n(function(i){var r=i;a.callHandler&&(r=a),r.callHandler(l,JSON.stringify(c),function(i){e(i)})})};var n=function(i){var a=function(){d(DidiJSBridge),i(DidiJSBridge)};window.DidiJSBridge?a():document.addEventListener("DidiJSBridgeReady",a,!1)},t=!1,d=function(i){if(t===!1){if(t=!0,navigator.userAgent.match(/iphone/i))return i.init&&i.init({});a.callHandler=function(a,e,n){var t,d=Array.prototype.slice.call(arguments,0);if(r.indexOf(a)>-1){if(t="didibridge"+~~(1e6*Math.random()),window[t]=function(){window[t]=void 0,n.apply(null,arguments)},d[2]=void 0,"string"==typeof d[1]){var e=JSON.parse(d[1]);e.callback=t}d[1]=JSON.stringify(e),e.callback=t,i.callHandler(d[0],d[1])}else i.callHandler.apply(i,d)}}}});