define("page/whycanyou/first/first.js",function(a,e){function t(){var a=e.check_filed();a!==!1&&(a=$.extend({},pageParams.upload_data,a),window.dd.dialog.loading("正在提交",5e3),$.ajax({type:"POST",url:pageParams.submit_url,data:a,success:function(a){var e;try{if(e=JSON.parse(a),0!=e.errno)return"101"==e.errno&&setTimeout(function(){location.replace(pageParams.homeurl)},2e3),dd.dialog.alert(e.errmsg);var t=e.data.shareinfo.link;if(t=t.replace(new RegExp("^"+location.protocol+"\\/\\/"+location.host),""),window.history.pushState){window.history.pushState({},document.title,t);var n=$.extend({step:2},e.data);d(n)}else location.href=t}catch(o){return dd.dialog.alert("网络有点不给力，请稍后再试哦~")}dd.dialog.loading("正在提交",0)},error:function(){dd.dialog.alert("网络有点不给力，请稍后再试哦~")}}))}function n(a){a!==!1&&v.empty().addClass("upload_box_hide")}function o(a,e){function t(){var r=Date.now()-n;window.DidiJSBridge?a(!0,r):e>r?setTimeout(t,o):a(!1,r)}var n=Date.now(),o=100;e=e||2e3,t()}function r(a){v.attr("data-value",a),$(".head_pic_source").css({"background-image":"url("+a+")"})}function i(){}function l(a){var e=dd.dialog,t={data:$.extend({},pageParams.upload_data),url:pageParams.upload_url,outputWidth:100,outputHeight:100,filekey:"file",onSuccessUpload:function(a){try{if(a=JSON.parse(a),"0"==a.errno)r(a.data);else{if("101"!=a.errno)return void e.alert(a.errmsg);e.alert("请重新登录")}}catch(t){return e.alert("上传失败，请重试！"),void i()}},onCancelUpload:function(){},onFailedUpload:function(){dd.dialog.alert("上传失败，请重试！")}};new c(a,t)}var d,u=a("page/whycanyou/login/login.js")(pageParams.loginurl),c=a("imgcliper"),s=e.$container=$(".first"),f=!1;e.wakeup=function(a,e){d=e,f||(f=!0)};var p=[["人人能当堵侠，不做闪电侠","全民顺风，挑战早晚高峰"],["下班六点，到家九点","全民顺风，挑战早晚高峰"],["线上越来越快，路上越来越慢","全民顺风，挑战早晚高峰"]],h=p[Math.round(Math.random()*(p.length-1))],g={username:{alert:"请填写你的大名",placeholder:"滴滴小伙伴"},whycontent:{alert:"请填写你的第一句倡议",placeholder:h[0]},cancontent:{alert:"请填写你的第二句倡议",placeholder:h[1]}},m=["username","whycontent","cancontent"];m.forEach(function(a){$("#"+a).val(g[a].placeholder).one("touchstart",function(){this.value=""})}),e.check_filed=function(){var a,e={};e[v.attr("data-name")]=v.attr("data-value");for(var t=0,n=m;a=n[t++];){var o=$("#"+a).val().trim();if((""==o||o==g.username.placeholder)&&1==t)return dd.dialog.alert({title:"",tip:g[a].alert,btn:{handler:function(){$("#"+a).focus()}}}),!1;e[a]=o}return e},$(["#"+m[1],"#"+m[2]].join(",")),$("#"+m[0]).on("blur",function(){this.value=this.value.replace(/([\u4E00-\u9FA5|\w]{5})(.+)/,"$1")}),s.find(".btn-common").on("click",function(){0==pageParams.islogin?u.show(function(){pageParams.islogin=1,t()}):t()});var v=$(".upload_box");$(function(){$(".bg").css({"min-height":"0"})}),l(v[0]),o(n,2e3)});