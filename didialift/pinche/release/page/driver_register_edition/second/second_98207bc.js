define("page/driver_register_edition/second/second.js",function(e,t){function r(e,t){var r=document.createElement("IMG");r.onload=function(){t(r),r.onerror=r=r.onload=null},r.onerror=function(){t(null),r.onerror=r=r.onload=null},r.src=e}function n(e){return"string"!=typeof e&&(e=e.getAttribute("name")),1==pageParams.filed_list[e].changeable}function i(e){return"string"!=typeof e&&(e=e.getAttribute("name")),3==pageParams.filed_list[e].verify}function a(){var t=e("upload/upload.js");$.each(k.find(".file_select"),function(e,r){if(n(r)){var i=function(){document.body.onfocus=null,y[e].close()},a=y[e].$container;y[e].$container.show(),"string"==typeof P[e]?y[e].setPic(P[e]):l(function(t){y[e].setPic(t)}),new t(a[0],{data:$.extend({},pageParams.upload_data),url:pageParams.api_upload_url,outputWidth:E[e][0],outputHeight:E[e][1],filekey:"file",onSuccessUpload:function(t){try{if(t=JSON.parse(t),"0"!=t.errno)return void h.alert({title:"",tip:t.errmsg,btn:{handler:function(){}}});T(x[e],t.data)}catch(r){return h.alert({title:"",tip:"上传失败，请重试！",btn:{handler:function(){}}}),void G(x[e],r)}i()},onCancelUpload:function(){i()},onFailedUpload:function(){i(),h.alert({title:"",tip:"上传失败，请重试！",btn:{handler:function(){}}}),i()}}),y[e].$container.hide(),$(r).on("click",function(){y[e].show(),document.body.onfocus=i},!1)}})}function o(){a(),x.forEach(function(e){var t=pageParams.filed_list[e].value||m.get(e);t&&T(e,t)}),i(x[0])&&n(x[0])&&k.addClass("verify_failed"),k.find(".form_second .previous_btn").on("click",function(){s()}),k.find(".next_btn").on("click",function(){var e=t.check_filed();if(e!==!1){var r=dd.base,n=dd.dialog;f.showLoading(),$.ajax({method:"GET",url:pageParams.reg_url,data:$.extend({step:2,token:pageParams.upload_data.token},e),success:function(e){var t=r.txtToJson(e);if("102"==t.errno)location.replace(pageParams.gologinurl);else if("0"==t.errno)m.clean(),d({travelauthpicurl:O.travelauthpicurl});else{if("3002"!=t.errno)return n.alert(t.errmsg);m.clean(),d({travelauthpicurl:O.travelauthpicurl})}f.closeLoading()},error:function(){n.alert("网络有点不给力，请稍后再试哦~")}})}})}function c(){for(var e=0;e<x.length;e++)if(!O[x[e]])return k.trigger("is_full_fill",!1),!1;k.trigger("is_full_fill",!0)}function l(e){if(J)return void e(J);if(U[U.length]=e,!(U.length.length>1)){var t=pageParams.gesture_url;$.ajax({method:"GET",url:t,data:{},success:function(e){var t=dd.base.txtToJson(e);if("0"!=t.errno)return h.alert(t.errmsg);J=t.gesturesample,J=J&&-1===J.indexOf("test.didi")?t.gesturesample:Math.random()>.5?_:v;for(var r;r=U.shift();)r(J)},error:function(){h.alert("获取手势图失败，因为网络有点不给力，请稍后再试哦~")}})}}var d,s,u=e("page/driver_register_edition/second/layer.js"),f=e("page/driver_register_edition/tool.js"),p="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/driver_card_050b750.png",g="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/car_license_e5ed36a.png",_="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/gestures_left_1c905cd.png",v="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/gestures_right_a51b567.png",h=(pageParams.gesturesample,dd.dialog),m=f.localCache.instance("driver_register_second"),b=!1,k=t.$container=$(".form_second");t.wakeup=function(e,t,r){d=t,s=r,b===!1&&(b=!0,o())};var x=["driveauthpicurl","travelauthpicurl","gestureauthpicurl"],j=[".driving_licence_front",".driving_licence_backend",".car_photo"],P=[p,g,l],y=[new u,new u,new u],w=213/145,C=500,E=[[C,C/w],[C,C/w],[C,C]],O={},T=function(e,t){var n=x.indexOf(e);if(-1!==n){var i=$(j[n]);O[e]=t,i.addClass("photo_uploaded"),r(t,function(t){return null===t?(dd.dialog.alert({title:"",tip:"图片上传失败，请重新上传。",btn:{handler:function(){}}}),void G(e)):(t.className="pic",void i.find(".shadow").html(t))}),m.save_cache(e,t),c()}},G=function(e){var t=x.indexOf(e);-1!==t&&($pick_node=$(j[t]),$pick_node.removeClass("photo_uploaded"),delete O[e],m.remove_cache(e,val),c())};t.check_filed=function(){var e,t=!0;if($.each(x,function(r,n){return void 0==O[n]?(e=r,t=!1):void 0}),t===!1){var r=$(j[e]).find(".select_tips").text()||"完整资料";return h.alert({title:"",tip:"请上传"+r,btn:{handler:function(){}}}),!1}return O};var J=!1,U=[]});