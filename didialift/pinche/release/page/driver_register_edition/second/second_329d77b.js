define("page/driver_register_edition/second/second.js",function(e,a){function t(e,a){var t=document.createElement("IMG");t.onload=function(){a(t),t.onerror=t=t.onload=null},t.onerror=function(){a(null),t.onerror=t=t.onload=null},t.src=e}function r(e){return"string"!=typeof e&&(e=e.getAttribute("name")),1==pageParams.filed_list[e].changeable}function n(e){return"string"!=typeof e&&(e=e.getAttribute("name")),1==pageParams.filed_list[e].display}function i(e){return"string"!=typeof e&&(e=e.getAttribute("name")),3==pageParams.filed_list[e].verify}function o(){function a(e){function a(){document.body.onfocus=null,j[e].close()}var t={data:$.extend({},pageParams.upload_data),url:pageParams.api_upload_url,outputWidth:C[e][0],outputHeight:C[e][1],filekey:"file",onSuccessUpload:function(t){try{if(t=JSON.parse(t),"0"==t.errno)O(k[e],t.data);else{if("101"!=t.errno)return void v.alert(t.errmsg);location.replace(pageParams.gologinurl)}}catch(r){return v.alert("服务器故障，上传失败，请重试！"),void S(k[e],r)}a()},onCancelUpload:function(){a()},onFileSelect:function(e,t){a(),t()},onFailedUpload:function(){a(),v.alert("上传超时，请重试！"),a()}},r=j[e].$container;r.show(),new n(r[0],t),r.hide()}function t(a){function t(){document.body.onfocus=null,j[a].close()}var r=j[a].$container;r.on("click",function(){var r=e("ddbridge/ddbridge.js"),n=$.extend({},pageParams.upload_data,{web_token:pageParams.upload_data.token});delete n.token,r.uploadImage(n,function(e){try{e=JSON.parse(e),O(k[a],e.data.data)}catch(r){S(k[a],r)}t()},null,pageParams.api_upload_url)})}var n=e("upload/upload.js");$.each(y.find(".file_select"),function(e,n){function o(){document.body.onfocus=null,j[e].close()}var l=$(n);if(r(n)===!1)return void l.addClass("disabled");i(k[e])&&r(k[e])&&l.addClass("verify_failed"),"string"==typeof P[e]?(j[e].setOpt({img_src:P[e]}),j[e].setup()):P[e](function(a){var t=["e_avatar_1","e_avatar_2"];j[e].setOpt({img_src:a,custom_class:t[pageParams.gesturesample-1]}),j[e].setup()});var c=!1;l.on("click",function(){if(j[e].show(),document.body.onfocus=o,p.photo_upload_click(k[e]),c!==!0){c=!0,$(this).removeClass("verify_failed");var r=window.DidiJSBridge;r&&/android/i.test(navigator.userAgent)?t(e):a(e),j[e].show()}},!1)})}function l(){o(),k.forEach(function(e){var a=pageParams.filed_list[e].value||m.get(e);a&&O(e,a)}),y.find(".form_second .previous_btn").on("click",function(){s()}),y.find(".next_btn").on("click",function(){function e(e){var a=r.txtToJson(e);if("102"==a.errno)location.replace(pageParams.gologinurl);else if("0"==a.errno)m.clean(),d({travelauthpicurl:A.travelauthpicurl});else{if("3002"!=a.errno)return n.alert(a.errmsg);m.clean(),d({travelauthpicurl:A.travelauthpicurl})}f.closeLoading()}var t=a.check_filed();if(t!==!1){f.showLoading(),$.ajax({type:"GET",url:pageParams.reg_url,data:$.extend({step:2,token:pageParams.upload_data.token},t),success:e,error:function(){n.alert("网络有点不给力，请稍后再试哦~")}});var r=dd.base,n=dd.dialog}})}function c(){for(var e=0;e<k.length;e++)if(r(y.find(b[e])[0])!==!1&&!A[k[e]])return y.trigger("is_full_fill",!1),!1;y.trigger("is_full_fill",!0)}var d,s,u=e("page/driver_register_edition/second/layer/layer.js"),f=e("page/driver_register_edition/tool.js"),p=e("page/driver_register_edition/log/log.js"),g="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/driver_card_050b750.png",_="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/car_license_e5ed36a.png",v=(pageParams.gesturesample,dd.dialog),m=f.localCache.instance("driver_register_second"),h=!1,y=a.$container=$(".form_second");a.wakeup=function(e,a,t){if(d=a,s=t,h===!1){h=!0;var r=!0;if($.each(k,function(e,a){return n(a)?(r=!1,!1):void 0}),r)return c(),void d();l()}};var k=["driveauthpicurl","travelauthpicurl","gestureauthpicurl"],b=[".driving_licence_front",".driving_licence_backend",".car_photo"],P=[g,_,"http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/layer/images/avatar_right2_d781194.jpg"],j=[new u({layerType:u.CARD}),new u({layerType:u.CARD}),new u({layerType:u.GESTURE,custom_class:""})],w=213/145,x=500,C=[[x,x/w],[x,x/w],[x,x]],A={},O=function(e,a){var r=k.indexOf(e);if(-1!==r){var n=$(b[r]);A[e]=a,n.addClass("photo_uploaded"),t(a,function(a){return null===a?(dd.dialog.alert({title:"",tip:"图片加载失败，请重新上传。",btn:{handler:function(){}}}),void S(e)):(p.photo_upload_success(k[r]),a.className="pic",void n.find(".shadow").html(a))}),m.save_cache(e,a),c()}},S=function(e){var a=k.indexOf(e);-1!==a&&($pick_node=$(b[a]),$pick_node.removeClass("photo_uploaded"),delete A[e],m.remove_cache(e),c())};a.check_filed=function(){var e,a=!0,t={};if($.each(k,function(n,i){return r(i)!==!1?(t[i]=A[i],void 0==t[i]?(e=n,a=!1):void 0):void 0}),a===!1){var n=$(b[e]).find(".select_tips").text()||"完整资料";return v.alert({title:"",tip:"请"+n,btn:{handler:function(){}}}),!1}return t}});