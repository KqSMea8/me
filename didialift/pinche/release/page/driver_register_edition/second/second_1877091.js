define("page/driver_register_edition/second/second.js",function(e,a){function r(e,a){var r=document.createElement("IMG");r.onload=function(){a(r),r.onerror=r=r.onload=null},r.onerror=function(){a(null),r.onerror=r=r.onload=null},r.src=e}function n(e){return"string"!=typeof e&&(e=e.getAttribute("name")),1==pageParams.filed_list[e].changeable}function t(e){return"string"!=typeof e&&(e=e.getAttribute("name")),3==pageParams.filed_list[e].verify}function i(){function a(e){function a(){document.body.onfocus=null,x[e].close()}var r={data:$.extend({},pageParams.upload_data),url:pageParams.api_upload_url,outputWidth:j[e][0],outputHeight:j[e][1],filekey:"file",onSuccessUpload:function(r){try{if(r=JSON.parse(r),"0"==r.errno)J(P[e],r.data);else{if("101"!=r.errno)return void _.alert(r.errmsg);location.replace(pageParams.gologinurl)}}catch(n){return _.alert("上传失败，请重试！"),void O(P[e],n)}a()},onCancelUpload:function(){a()},onFailedUpload:function(){a(),_.alert("上传失败，请重试！"),a()}},n=x[e].$container;n.show(),new i(n[0],r),n.hide()}function r(a){function r(){document.body.onfocus=null,x[a].close()}var n=x[a].$container;n.on("click",function(){var n=e("ddbridge/ddbridge.js"),t=$.extend({},pageParams.upload_data,{web_token:pageParams.upload_data.token});delete t.token,n.uploadImage(t,function(e){try{e=JSON.parse(e),J(P[a],e.data.data)}catch(n){O(P[a],n)}r()},null,pageParams.api_upload_url)})}var i=e("upload/upload.js");$.each(h.find(".file_select"),function(e,i){function o(){document.body.onfocus=null,x[e].close()}if(n(i)){$file_select=$(i),t(P[e])&&n(P[e])&&$file_select.addClass("verify_failed"),"string"==typeof k[e]?x[e].setPic(k[e]):c(function(a){x[e].setPic(a)});var l=!1;$file_select.on("click",function(){if(x[e].show(),document.body.onfocus=o,l!==!0){l=!0,$(this).removeClass("verify_failed");var n=window.DidiJSBridge;n?r(e):a(e)}},!1)}})}function o(){i(),P.forEach(function(e){var a=pageParams.filed_list[e].value||v.get(e);a&&J(e,a)}),h.find(".form_second .previous_btn").on("click",function(){u()}),h.find(".next_btn").on("click",function(){var e=a.check_filed();if(e!==!1){var r=dd.base,n=dd.dialog;f.showLoading(),$.ajax({method:"GET",url:pageParams.reg_url,data:$.extend({step:2,token:pageParams.upload_data.token},e),success:function(e){var a=r.txtToJson(e);if("102"==a.errno)location.replace(pageParams.gologinurl);else if("0"==a.errno)v.clean(),d({travelauthpicurl:C.travelauthpicurl});else{if("3002"!=a.errno)return n.alert(a.errmsg);v.clean(),d({travelauthpicurl:C.travelauthpicurl})}f.closeLoading()},error:function(){n.alert("网络有点不给力，请稍后再试哦~")}})}})}function l(){for(var e=0;e<P.length;e++)if(!C[P[e]])return h.trigger("is_full_fill",!1),!1;h.trigger("is_full_fill",!0)}function c(e){if(E)return void e(E);if(S[S.length]=e,!(S.length.length>1)){var a=pageParams.gesture_url;$.ajax({method:"GET",url:a,data:{},success:function(e){var a=dd.base.txtToJson(e);if("0"!=a.errno)return _.alert(a.errmsg);E=a.gesturesample;for(var r;r=S.shift();)r(E)},error:function(){_.alert("获取手势图失败，因为网络有点不给力，请稍后再试哦~")}})}}var d,u,s=e("page/driver_register_edition/second/layer.js"),f=e("page/driver_register_edition/tool.js"),p="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/driver_card_050b750.png",g="http://static.xiaojukeji.com/pinche/release/page/driver_register_edition/second/car_license_e5ed36a.png",_=(pageParams.gesturesample,dd.dialog),v=f.localCache.instance("driver_register_second"),m=!1,h=a.$container=$(".form_second");a.wakeup=function(e,a,r){d=a,u=r,m===!1&&(m=!0,o())};var P=["driveauthpicurl","travelauthpicurl","gestureauthpicurl"],b=[".driving_licence_front",".driving_licence_backend",".car_photo"],k=[p,g,pageParams.gesturesample&&0==pageParams.gesturesample.indexOf("http")?pageParams.gesturesample:c],x=[new s,new s,new s],y=213/145,w=500,j=[[w,w/y],[w,w/y],[w,w]],C={},J=function(e,a){var n=P.indexOf(e);if(-1!==n){var t=$(b[n]);C[e]=a,t.addClass("photo_uploaded"),r(a,function(a){return null===a?(dd.dialog.alert({title:"",tip:"图片加载失败，请重新上传。",btn:{handler:function(){}}}),void O(e)):(a.className="pic",void t.find(".shadow").html(a))}),v.save_cache(e,a),l()}},O=function(e){var a=P.indexOf(e);-1!==a&&($pick_node=$(b[a]),$pick_node.removeClass("photo_uploaded"),delete C[e],v.remove_cache(e,val),l())};a.check_filed=function(){var e,a=!0;if($.each(P,function(r,n){return void 0==C[n]?(e=r,a=!1):void 0}),a===!1){var r=$(b[e]).find(".select_tips").text()||"完整资料";return _.alert({title:"",tip:"请上传"+r,btn:{handler:function(){}}}),!1}return C};var E=!1,S=[]});