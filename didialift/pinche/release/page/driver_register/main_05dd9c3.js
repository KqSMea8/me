define("page/driver_register/main.js",function(e){window.dd=e("dd");var t=dd.base,n=function(){for(var e=document.getElementsByClassName("select-wall"),t=0,n=e.length;n>t;t++)document.body.removeChild(e[t])},a=function(){var e=document.createElement("div");e.id="d-wall",e.className="select-wall",e.style.width=document.clientWidth+"px",e.style.height=document.body.scrollHeight+"px",document.body.appendChild(e)},i=function(e,i,r){function c(e){var t=0,n=0;e.addEventListener("touchstart",function(e){if(e.preventDefault(),!e.touches.length)return!1;var n=e.touches[0];t=n.pageY-this.offsetTop},!1),e.addEventListener("touchmove",function(e){if(e.preventDefault(),!e.touches.length)return!1;var a=e.touches[0],i=a.pageY-this.offsetTop;n=t-i,t=i,this.scrollTop+=n},!1),e.addEventListener("touchend",function(e){if(e.preventDefault(),!e.changedTouches.length)return!1;t=0,n=0;var a=this.scrollTop,i=a%44;22>i?this.scrollTop-=i:this.scrollTop+=44-i},!1)}var o=r||[],l=[],s=i.getElementsByClassName("cancel")[0],u=i.getElementsByClassName("confirm")[0],d=i.getElementsByClassName("options");t.touch(e,function(){for(var e=document.getElementsByClassName("select"),t=0,n=e.length;n>t;t++)e[t].style.display="none";i.style.display="block",a();for(var c=null,o="",l=null,s=0,u=d.length;u>s;s++){c=d[s],o=r[s],l=c.getElementsByTagName("li");for(var m=0,f=l.length;f>m;m++)l[m].getAttribute("data-id")==o&&(c.scrollTop=44*m)}},!1),s.addEventListener("click",function(){i.style.display="none",n()},!1);var m=function(e){var t=document.createEvent("Events");return t.initEvent(e,!0,!0),t};u.addEventListener("click",function(){for(var t=null,a=null,r=0,c=d.length;c>r;r++){t=d[r];var s=t.scrollTop/44,a=t.getElementsByTagName("li")[s];o[r]=a.getAttribute("data-id"),l[r]=a.getAttribute("data-show")}var u=e.value;e.value=l.join(""),e.setAttribute("data-id",o.join("")),u!=e.value&&e.dispatchEvent&&e.dispatchEvent(m("change")),i.style.display="none",n()},!1);for(var f=0,_=d.length;_>f;f++)c(d[f],f)};dd.ready(function(){function t(){var e=document.getElementById("carnoSelect");ulEl=e.getElementsByClassName("options")[0];var t=function(){u.ajax({method:"POST",url:"/pinche/cartype/getlicensehead",succFunc:function(t){var n=u.txtToJson(t);if("0"==n.errno){for(var a=n.data,r=n.sort,c="",o=0,l=r.length;l>o;o++)c+='<li data-id="'+r[o]+'" data-show="'+a[r[o]]+'">'+a[r[o]]+"</li>";ulEl.innerHTML+=c,i(txt_carOne,e,[])}},failFunc:function(){}})};t()}function n(){var e=function(e,t){m[e]=t,localStorage.driver_form=JSON.stringify(m)};txt_realname.addEventListener("change",function(){e("txt_realname",this.value)},!1),txt_licence.addEventListener("change",function(){e("txt_licence",this.value)},!1),txt_carower.addEventListener("change",function(){e("txt_carower",this.value)},!1),txt_carOne.addEventListener("change",function(){e("txt_carOne",txt_carOne.value),e("txt_carOne_id",txt_carOne.getAttribute("data-id"))},!1),txt_carOne2.addEventListener("change",function(){e("txt_carOne2",this.value)},!1),m&&(txt_realname.value=m.txt_realname||"",txt_licence.value=m.txt_licence||"",txt_carower.value=m.txt_carower||"",txt_carOne.value=m.txt_carOne||"",txt_carOne.setAttribute("data-id",m.txt_carOne_id||""),txt_carOne2.value=m.txt_carOne2||"")}function a(){txt_realname.addEventListener("focus",function(){this.className=""},!1),txt_realname.addEventListener("blur",function(){f.is_Chinese_name(this.value)||(this.className="error")},!1),txt_licence.addEventListener("focus",function(){this.className=""},!1),txt_licence.addEventListener("blur",function(){f.is_ID_card(this.value)||(this.className="error")},!1),txt_carower.addEventListener("focus",function(){this.className=""},!1),txt_carower.addEventListener("blur",function(){f.is_Chinese_name(this.value)||(this.className="error")},!1),txt_carOne2.addEventListener("focus",function(){this.className=""},!1),txt_carOne2.addEventListener("blur",function(){f.is_carNo(this.value)||(this.className="error")},!1)}function r(e){var t=function(e,t){d.alert({title:"",tip:t,btn:{handler:function(){e.focus()}}})};if("1"===pageParams.drive_license_changeable){if(!f.is_Chinese_name(e.drive_license_name))return t(txt_realname,"请填写真实姓名"),!1;if(!f.is_ID_card(e.drive_license_number))return t(txt_licence,"身份证号填写错误"),!1}if("1"===pageParams.travel_license_changeable){if(!f.is_Chinese_name(e.travel_license_name))return t(txt_carower,"行驶证姓名填写错误"),!1;if(""==txt_carOne.value)return d.alert("请选择车牌归属地"),!1;if(!f.is_carNo(e.car_license_number))return t(txt_carOne2,"车牌号填写错误"),!1}return!0}function c(e){d.loading("正在请求，请稍后~"),u.ajax({method:"POST",url:pageParams.submit_url,data:e,succFunc:function(e){var t=u.txtToJson(e);"0"==t.errno?(localStorage.removeItem("driver_form"),location.replace(t.url)):"3002"==t.errno?(localStorage.removeItem("driver_form"),location.replace(t.url)):l(function(){d.alert(t.errmsg)})},failFunc:function(){d.alert("网络有点不给力，请稍后再试哦~")}})}function o(e){$(".main").attr("class","main animate begin_animate"),setTimeout(function(){$(".main").attr("class","main animate end_animate")},0),setTimeout(function(){$(".main").attr("class","main ended_animate"),e()},350)}function l(e){$(".main").attr("class","main animate end_animate"),setTimeout(function(){$(".main").attr("class","main animate begin_animate")},0),setTimeout(function(){$(".main").attr("class","main"),e()},450)}function s(t){if(s.data_form=t,_!==!0){_=!0;var n=["driveauthpicurl","travelauthpicurl"],a=[".driving_licence_front",".driving_licence_backend"],i={},r=function(e,t){var r=n.indexOf(e);if(-1!==r){var c=$(a[r]);i[e]=t,c.addClass("photo_uploaded"),c.find(".shadow").css("background-image","url("+t+")"),h.set(e,t)}},o=function(e,t){var r=n.indexOf(e);-1!==r&&($pick_node=$(a[r]),$pick_node.find(".shadow").html("error | "+t.message),$pick_node.removeClass("photo_uploaded"),delete i[e])};addEventListener("error",function(e){$(".driving_licence_backend").find(".shadow").html(e.message)},!1),n.forEach(function(e){var t=h.get(e);t&&r(e,t)}),$(".upload_card").on("click",".file_select",function(t){var i=$(t.currentTarget),c=i.attr("class").trim();if(c=c.split(/\s+/)[1],0!=c){var l=a.indexOf("."+c);if(-1!==l){var s=e("ddbridge");s.uploadImage({web_token:pageParams.upload_token},function(e){try{e=JSON.parse(e),r(n[l],e.data.data)}catch(t){o(n[l],t)}},null,pageParams.api_upload_url)}}}),u.touch($(".register_submit")[0],function(){var e,r=!0;if($.each(n,function(t,n){return void 0===i[n]?(e=t,r=!1):void 0}),r===!1){var o=$(a[e]).find(".select_tips").text()||"完整资料";return void d.alert({title:"",tip:"请填写"+o,btn:{handler:function(){}}})}t=$.extend(s.data_form,i),c(t)})}}var u=dd.base,d=dd.dialog,m=u.txtToJson(localStorage.driver_form||{}),f={is_Chinese_name:function(e){var t=/^[\u4E00-\u9FA5]{2,}$/;return t.test(e)?!0:!1},is_ID_card:function(e){var t=/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/;return t.test(e)===!1?!1:!0},is_carNo:function(e){var t=/^[A-Za-z]{1}[A-Za-z0-9]{5}$/;return t.test(e)?!0:!1}};!function(){t(page_driver.car_province_id),"join"==pageParams.type&&n(),a(),$(btnSubmit).on("click",function(){if("btn-gray"!=btnSubmit.className){for(var e=document.getElementsByTagName("input"),t=0,n=e.length;n>t;t++){var a=e[t];a.setAttribute("readOnly","true"),a.blur()}scrollTo(0,0),setTimeout(function(){for(t=0,n=e.length;n>t;t++){var a=e[t];a.removeAttribute("readOnly")}},100);var i={drive_license_name:txt_realname.value,drive_license_number:txt_licence.value.toLocaleUpperCase(),travel_license_name:txt_carower.value,car_province_id:txt_carOne.getAttribute("data-id"),car_license_number:txt_carOne2.value.toLocaleUpperCase(),phone_number:pageParams.phone||"",token:pageParams.token||"",sign:pageParams.sign||""},c=r(i);c&&o(function(){s(i)})}})}();var _=!1,h={set:function(e,t){try{return localStorage.setItem(e,t),!0}catch(n){return!1}},get:function(e){try{return localStorage.getItem(e)}catch(t){return!1}},remove:function(e){try{return localStorage.removeItem(e),!0}catch(t){return!1}}}}),dd.ready(function(){function e(e){var e={title:"顺风出行，期待每一次的不期而遇。",desc:"滴滴顺风车车主有奖招募中，有车即可参与",link:location.href,imgUrl:"http://static.xiaojukeji.com/pinche/images/share.jpg"};wx.onMenuShareAppMessage({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,trigger:function(){},success:function(){},cancel:function(){},fail:function(){}}),wx.onMenuShareTimeline({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,trigger:function(){},success:function(){},cancel:function(){},fail:function(){}}),wx.onMenuShareQQ({title:e.title,desc:e.desc,link:e.link,imgUrl:e.imgUrl,trigger:function(){},complete:function(){},success:function(){},cancel:function(){},fail:function(){}})}var t=dd.base||{};t.ajax({method:"POST",data:{url:encodeURIComponent(location.href)},url:"/pinche/wxApi/getJsSdkConfig",succFunc:function(n){var a=t.txtToJson(n);if("0"==a.errno){var i={debug:!1,appId:"wxab524d83299d6c83",timestamp:a.timestamp,nonceStr:a.nonceStr,signature:a.signature,jsApiList:["onMenuShareTimeline","onMenuShareAppMessage","onMenuShareQQ"]};wx.config(i),wx.ready(function(){e()})}},failFunc:function(){}})}),window.addEventListener("DOMContentLoaded",function(){var e=document.getElementById("btnNativeShare"),t=document.getElementById("nativeShareUrl"),n=t?t.value:"",a=document.getElementById("btnDownload"),i={img_url:"http://static.xiaojukeji.com/pinche/images/share.jpg",title:"顺风出行，期待每一次的不期而遇。",desc:"滴滴顺风车车主有奖招募中，有车即可参与",link:n},r=function(e,t){for(var n=0,a=e.length;a>n;n++)t(e[n])},c=[{button:e,method:"invoke_entrance"}],o=function(e){r(c,function(t){!function(t){t.button.addEventListener("touchend",function(){"undefined"!=typeof e&&e.callHandler(t.method)})}(t)})},l={entrance:{icon:"http://static.diditaxi.com.cn/webapp/images/driver.png"},buttons:[{type:"share_weixin_timeline",name:"分享到微信朋友圈",data:{share_url:i.link,share_icon_url:i.img_url,share_img_url:i.img_url,share_title:i.title,share_content:i.desc,share_from:"native"},callback:function(){}},{type:"share_weixin_appmsg",name:"分享给微信好友",data:{share_url:i.link,share_icon_url:i.img_url,share_img_url:i.img_url,share_title:i.title,share_content:i.desc,share_from:"native"},callback:function(){}},{type:"share_qq_appmsg",name:"分享给QQ好友",data:{share_url:i.link,share_icon_url:i.img_url,share_img_url:i.img_url,share_title:i.title,share_content:i.desc,share_from:"native"},callback:function(){}},{type:"share_qzone",name:"分享到QQ空间",data:{share_url:i.link,share_icon_url:i.img_url,share_img_url:i.img_url,share_title:i.title,share_content:i.desc,share_from:"native"},callback:function(){}}]},s=function(){e.style.display="block",shareText.style.display="none",a&&(a.style.display="none");var t=document.getElementById("domTitle");t&&(t.innerHTML="顺风车车主招募")},u=function(e){window.DidiJSBridge?e(DidiJSBridge):document.addEventListener("DidiJSBridgeReady",function(){e(DidiJSBridge)},!1)};u(function(e){"undefined"!=typeof e&&(e.callHandler("init_entrance",JSON.stringify(l)),o(e),s())})},!1)});